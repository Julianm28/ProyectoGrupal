<!-- FrontEnd/aprobacion.html -->
<!DOCTYPE html>
<html lang="es">
<head><meta charset="utf-8"/><title>Aprobaci√≥n - CCSS</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="CSS/estilos.css"></head>
<body>
  <div id="nav-placeholder"></div>
  <div class="container-compact">
    <div class="card p-4 mt-4">
      <h3 class="page-title">Solicitudes pendientes</h3>
      <div id="pending-wrap"></div>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script>
    fetch('partials/navbar.html').then(r=>r.text()).then(t=>document.getElementById('nav-placeholder').innerHTML=t);

    async function loadPending(){
      try {
        const list = await apiFetch('/solicitudes?status=pending'); // o el endpoint que devuelva pendientes
        if (!list.length) return document.getElementById('pending-wrap').innerHTML = '<div class="alert alert-info">No hay solicitudes pendientes</div>';
        document.getElementById('pending-wrap').innerHTML = list.map(s=>`
          <div class="card p-2 mb-2">
            <div><b>${s.items[0].supplyName || 'Insumo'}</b> - Cant: ${s.items[0].qty}</div>
            <div class="mt-2">
              <button class="btn btn-sm btn-success" onclick="act('${s._id}','approve')">Aprobar</button>
              <button class="btn btn-sm btn-danger" onclick="act('${s._id}','reject')">Rechazar</button>
            </div>
          </div>
        `).join('');
      } catch (err) { console.error(err); document.getElementById('pending-wrap').innerHTML='<div class="alert alert-danger">Error</div>'; }
    }

    async function act(id,op){
      try {
        const endpoint = op === 'approve' ? `/solicitudes/${id}/approve` : `/solicitudes/${id}/reject`;
        await apiFetch(endpoint, { method:'POST' });
        loadPending();
      } catch (err) { alert(err.message || 'Error'); }
    }

    loadPending();
  </script>
</body>
</html>
